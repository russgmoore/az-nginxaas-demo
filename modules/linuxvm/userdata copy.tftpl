#!/usr/bin/env bash

set -euo pipefail

echo "[INFO] Adding packages"
apt-get update
apt-get install -y nginx git
systemctl enable nginx

echo "[INFO] Creating demo-index.html"


echo "[INFO] Creating /var/tmp/demo.txt"

echo "PCFET0NUWVBFIGh0bWw+CjxodG1sPgogICAgPGhlYWQ+CiAgICAgICAgPHRpdGxlPkhlbGxvIFdvcmxkIC0gQXBwIFggPCEtLSBSZXBsYWNlICdYJyB3aXRoICcxJyBvciAnMicgYXMgYXBwcm9wcmlhdGUgLS0+PC90aXRsZT4KICAgICAgICA8bGluayBocmVmPSJkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQUVBQUFBQkFDQVlBQUFDcWFYSGVBQUFHUEVsRVFWUjQydTFiRFV5VWRSai9pd3BvbE1sY2JacXRYRm5Oc3VTQ2V6L09JTWcxVjdTRk9OdWFVOFAxTVd5MWxjUFV5aEsxdVZiS2NYZnZ5Nkdpa1RHS0NtcEV5b2VqSmlwb3VVQmNnc2luaHdVS0tLSjhQRDN2bnpzeHVMdjM1UTY0NCtVZTltd0gzUDNmNS9kN242LzMvMytPRUovNHhDYys4WVFZdFF1SndCMGtJcCtKcnpVVEI3aUp1d2VCZjRiYVRsSjVvQ3F3MTFDL0pIcCt0bnFCYjFuZ1Q0ejhXZ1JlVFVHYldDQkdxMHF2S1JGY0hmNGVUL1pGQktvTHZNQkdJYmhpWWthUUlqY0FmTEFLK0Q4ejlZaGp4TWdzVlVHYzg0K2d5eDlBWUQwa2hYY01mTENtVUJMNjhITVorUG5IeHlGdzNVd2k4QjhoZ0pZaDdqNGM3YzhQVjVDRWJVVFV6Qm9IY1U3OGlJbC9GWUZYV21QYU5lQzNxNG16NVljcUpQSTFKR0txbDJaM2hrY2pENUVVem5tY3U2cWlOVCtZMkNQRW9IM1dtNEEvUUVSV1FGZTlRUTBjYWVDRGxTWkpyaHQxSHhHMEQzc091Q0VpQ0ExYWo0WlkzSXB6bDhMaVZ0bjhoeGk1elJnV004WVlQQk9ERi85enhPTGNWUlZzK1lHdHdGenhDczFCbzl5K2F2QmlPVFFlVXp3STNGNStrT3d4c1hra21XTkhIcmpVb2txdHF0U3l5c1c1Z1VIVjRtdG1aRUhTZFJrbCthRUx2Y0ZJUk4zOTdnUFBYRDRaZ2J4SlcxUzVPSmRBNjBNZ1VBeUh1MUtmQXorcGZDVXR3citIdVFjOE9SUTFqSzRaZ0dzVHZjWTV1UVA1b1lrWTJIZmNLNXNHTHBTNmwxeFpRd05uN1hrZWRwM09nTXJXQzFEWDBRd25tcy9BMXJLOWNGOWF0TlZvMThEUC8zbzVmRjk5QkdvN0xGRFJXZ01KSlFhWVF2L1B5T2NIeVNQMFRJVHJCSWhZYitXU0hMcmxOR0V4NU5lWGdqMnBhVzhDNXJzNDZoM0RjM2t0M0cyT2dyOWFxb2VzK2Y1UnZiTDFhSjVpWG5LbnhrZklFb0IzTi96SGVIQW1GOW92d3J5dll2QzlUeXNuSUNrRW9uUFgyMTJ2dk9VOCtBczZlUytRQ0RBdzBhTkxBQnE2TE84RGtKTVNTem5NTUVmU2NGRkd3Q0pZWGJEVjdscTE3UllJUXUrUVRZcGpSVUJNM2daUUl0K2NPd3lUcFdScFlCUVJzS3JnVTRjZU5TNEprQ1N4TEkxK1pzSVMwTnZYQjZzTEUvdEw1RVFrUUpLT201MllPTjl5N2dscUprQ1NPcXpyRDZVdmMxd1oxRUJBMDdWL0lhZm1ONGNrSEcrdWdKa1NFSHVWUVEwRU5GeTlCTFAzUjBOUjR5bUhKR1JXRldCblo2ZlBWd01CRjlFRGdyRDJ6MFVTcXRvYUhKS3c0OVNCb1oyZFdnZ0l4bWNFc3ZzcFlMTGk0UEtORHJ2djY4T2Z1S0x0LzY4TXFpSkFhbjRRMElwRG02RzdyOGZ1ZTY5Mlg0Zkk3UGlCeXFBNkFxeWdOaDBYSElhQ2xET2twejlhR1ZSSkFCbzhDVFArM3NxZkhaSlFlcWtTZ3ZIWm4reGFxRUlDS0FsaEVDU0dPNjBNV2RWRjRJY2VzREwvRXhVU1lOM29rQ3JEMzFmcUhaTHdjV2txNW93UFZVb0EzVWNJZ2RCdjEwQnJWN3ZkejNiMzlrQmh3MGtWRTJCTmlyRy9icVJnaHlQcUljQktRa0tKY1ZnRTFMUTF3UjNTNW9vcUNEQktsU0VVekdkeUZCTnd2cTFSVFFUMGI0Qk9GNStCZ29heUNVcUF0VExNU1hzUnpsNnVIWDhFT05vVXRYUzJLQ2ZBdXNPc3lWd0ZMVjF0em5OQXV6ZmxBR3hiK1IvZXNHdW9kRGNEMGJVVmJZTGVsaFJmL21XRDA4b2dkWXRUak53WWJJc3JPUmhCSXdKTVBPVFdIaDFpNkxyaXoxMDdGVUt2aWl2Y1p2ZnA4V1p2TjhUbWJWUzJydHNISThtTXRuOWdTZTUwS0F6Nzl5V3c4NDkwT0dZcHA4bHNUVUdpY3RkM0VBNlBIVndCMjArbVlVTlVSby9hTXM0ZGhxanNkY29PV0d4SDV5WXUwZzBQMEV6RkJkN0R4Wm9WSFk3YUhtV3RCNlZ1bndoTEI2UDBnRlVMazZ6aEpudm5CdzVIVzlEOU41R2twUUVqTUJjUU9nK0pNQk54ak1aZ0hJU2F3dkdaSGlLdyswbXlidjVvelAwdHhndmswN0FRdld4QW9oOThzWHN1cjNSbXdNU3R4SXVkOWZpSXpNQUlYVFY2eU5xeEhhSDdnZzFHQTdiZ3hWdkhmRWpxMWhBbDEwWk0vQTQ2Z08weDBiT1BvaUhwU0VEdnNNWmhYVlZiVlJMNFRMejJFMTQwRUsxZGdzbm5kOW1CYUhjbXd1aWdKSGVDR0xrWHZITmFOSE9CUDRKL0hZbW9HYkd3c0pVMWthMG5Bdk0yaHQ0MDc1OFpObXZ2UlJKMjRsM3JvTWE3TXhWcTRqcFJkeU1SYzhiaDl3UjBUeUlSV2RSOWh6TlhhSnMzRnRpZjZLRFd1QmNCSDBoRXJreTJiTnJhVjVFOWpjQmppYXBFMUV4SGtPOGlFWTFPdmpMVGpBa3VnZXpoN3lTcUZVUG9YSFR0WkFSN25jWTRyUnJZWWd0Y0N0R0hQVWdtakVoUG1pS1hqWGMvbDRnNkhmR0pUM3ppRXcvSWY4Nkp6Qi9ZTWt1OUFBQUFBRWxGVGtTdVFtQ0MiIHJlbD0iaWNvbiIgdHlwZT0iaW1hZ2UvcG5nIiAvPgogICAgICAgIDxzdHlsZT4KICAgICAgICAgICAgYm9keSB7CiAgICAgICAgICAgICAgICBtYXJnaW46IDBweDsKICAgICAgICAgICAgICAgIGZvbnQ6IDIwcHggJ1JvYm90b1JlZ3VsYXInLCBBcmlhbCwgc2Fucy1zZXJpZjsKICAgICAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiAxMDA7CiAgICAgICAgICAgICAgICBoZWlnaHQ6IDEwMCU7CiAgICAgICAgICAgICAgICBjb2xvcjogIzBmMTQxOTsKICAgICAgICAgICAgfQogICAgICAgICAgICBkaXYuaW5mbyB7CiAgICAgICAgICAgICAgICBkaXNwbGF5OiB0YWJsZTsKICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6ICNlOGVhZWM7CiAgICAgICAgICAgICAgICBwYWRkaW5nOiAyMHB4IDIwcHggMjBweCAyMHB4OwogICAgICAgICAgICAgICAgYm9yZGVyOiAxcHggZGFzaGVkIGJsYWNrOwogICAgICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogMTBweDsKICAgICAgICAgICAgICAgIG1hcmdpbjogMHB4IGF1dG8gYXV0byBhdXRvOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGRpdi5pbmZvIHAgewogICAgICAgICAgICAgICAgZGlzcGxheTogdGFibGUtcm93OwogICAgICAgICAgICAgICAgbWFyZ2luOiA1cHggYXV0byBhdXRvIGF1dG87CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGl2LmluZm8gcCBzcGFuIHsKICAgICAgICAgICAgICAgIGRpc3BsYXk6IHRhYmxlLWNlbGw7CiAgICAgICAgICAgICAgICBwYWRkaW5nOiAxMHB4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGltZyB7CiAgICAgICAgICAgICAgICB3aWR0aDogMTc2cHg7CiAgICAgICAgICAgICAgICBtYXJnaW46IDM2cHggYXV0byAzNnB4IGF1dG87CiAgICAgICAgICAgICAgICBkaXNwbGF5OmJsb2NrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGRpdi5zbWFsbGVyIHAgc3BhbiB7CiAgICAgICAgICAgICAgICBjb2xvcjogIzNENTI2NjsKICAgICAgICAgICAgfQogICAgICAgICAgICBoMSwgaDIgewogICAgICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDEwMDsKICAgICAgICAgICAgfQogICAgICAgICAgICBkaXYuY2hlY2sgewogICAgICAgICAgICAgICAgcGFkZGluZzogMHB4IDBweCAwcHggMHB4OwogICAgICAgICAgICAgICAgZGlzcGxheTogdGFibGU7CiAgICAgICAgICAgICAgICBtYXJnaW46IDM2cHggYXV0byBhdXRvIGF1dG87CiAgICAgICAgICAgICAgICBmb250OiAxMnB4ICdSb2JvdG9SZWd1bGFyJywgQXJpYWwsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgI2Zvb3RlciB7CiAgICAgICAgICAgICAgICBwb3NpdGlvbjogZml4ZWQ7CiAgICAgICAgICAgICAgICBib3R0b206IDM2cHg7CiAgICAgICAgICAgICAgICB3aWR0aDogMTAwJTsKICAgICAgICAgICAgfQogICAgICAgICAgICAjY2VudGVyIHsKICAgICAgICAgICAgICAgIHdpZHRoOiA0MDBweDsKICAgICAgICAgICAgICAgIG1hcmdpbjogMCBhdXRvOwogICAgICAgICAgICAgICAgZm9udDogMTJweCBDb3VyaWVyOwogICAgICAgICAgICB9CiAgICAgICAgPC9zdHlsZT4KCiAgICAgICAgPHNjcmlwdD4KICAgICAgICAgICAgdmFyIHJlZjsKICAgICAgICAgICAgZnVuY3Rpb24gY2hlY2tSZWZyZXNoKCkgewogICAgICAgICAgICAgICAgaWYgKGRvY3VtZW50LmNvb2tpZSA9PSAicmVmcmVzaD0xIikgewogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjaGVjayIpLmNoZWNrZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIHJlZiA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKXtsb2NhdGlvbi5yZWxvYWQoKTt9LCAxMDAwKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gY2hhbmdlQ29va2llKCkgewogICAgICAgICAgICAgICAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjaGVjayIpLmNoZWNrZWQpIHsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5jb29raWUgPSAicmVmcmVzaD0xIjsKICAgICAgICAgICAgICAgICAgICByZWYgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7bG9jYXRpb24ucmVsb2FkKCk7fSwgMTAwMCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmNvb2tpZSA9ICJyZWZyZXNoPTAiOwogICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dChyZWYpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgPC9zY3JpcHQ+CiAgICA8L2hlYWQ+CgogICAgPGJvZHkgb25sb2FkPSJjaGVja1JlZnJlc2goKTsiPgogICAgICAgIDxpbWcgYWx0PSJOR0lOWCBMb2dvIiBzcmM9ImRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBV0FBQUFCSUNBTUFBQUQvTjkrUkFBQUFWRkJNVkVVQUFBQUFtUUFBbVFBQW1RQUFtUUFBbVFBQW1RQUFtUUFBbVFBQW1RQUFtUUFBbVFBQW1RQUFtUUFBbVFBQW1RQUFtUUFBbVFBQW1RQUFtUUFBbVFBQW1RQUFtUUFBbVFBQW1RQUFtUUFBbVFBQW1RREJlY3QrQUFBQUczUlNUbE1BQjBBWThTRDVTTTgydjFucHNKL1lqU2wwRVZMZnRxbGxnTWRaZ3NvUUFBQUhkMGxFUVZSNDJzelo2WGFiTUJDRzRaR0Z4U2F6THpaei8vZlpjOUk0SnBiRU44TFEwL2RuR3dKNURKR0cwSGRwTTlra3V6VlhpcXVzc21ScExyUmRud3FEcDllUHlZN3pYZEZicXB0SE96MDBSVFZVeFdpeXF1dkoyNlVwa25wMi9oZVdOMFV5enQzcVl0S01uODA1eWJzVy9MZEswMVlWQzZzVkVMSDgxWEo5bzZqNXE2UWtjZXBlODNkSnA4aXBmMTYxSFNnbTFUeVBLNS8vY3VOMWQ1S21FMzQyYnNua0xLNmhyZTc4TE5HMEt1V2ZPckZEd2F0czY5dzhsbitxRklscng5VnhmODgwOGU4ZUpHeDlZRVhoQ3BaM2tYMmdmRnRiclg0bTA1SW9uVEU3d3NHTG5wWFkxL0txcjN2LzVyK05jQU92eThIWENSdDc0VythbEg1NjhLcUNKS21NMzdMYWZWaGUzWlRVMS9tbUE3dVY5QXI4dlBqWlZDUERaSStDRGR3RkM2OHlJb29abmJobUlBeDhYeW9adTVtY1lPOUh6aFNvNDdnR0NxUjUzVUxQbEFHUGt1eWF6SlZlS1dZc2pIMTVEankvVmhQTzhMb00vT0pFNFhOZmVKMTlMVWZSajE4S0Y5Z0xBMkdaTDQvVXNMZEZIUVZjY1d5VENEalpEOXdtN0t0MlBnSWdqSDNaQmxmNDZpRGduT083bnd1c2F2Wm1Wb0NhUFUwcTFwY25zaHlvT3dhNDRQaVM2Nm5BTnc3VTBpc2JLNXg3ajNnUUIwdVBBQjU0VDhXWndBL1JIcnhoTEl4OVRic0JuTFNmQTZ1UmQ5V2RCenl3Q0ZpTlVjSjV3cjRlUkJ5dTdqOEc3bmhmcGowTHVFMEE4T3RzU0JqN1pvb0lMK2R5WUx4Rm0yNytFdmZTemdIdWEvR1lYckszUW9sOWEwM2J3TnhFQWVNdDJpeC9icHR6Z0NlR3dGaFk3b3VBdWZ3SU9BL1BTbmkzbko4QjNEQUVsZ3RqWHd4czhrK0FsL0JkaVZmRFdoMFBQREFBamhYR3ZnVG5Wamt3dWp6YmsxdDRUV2tPQjI0VEJCd3JqSDJKUVpuYUM2eEdzUGRDVDI5Nk1IQS9NZ0tXQzJOZkw3QmxwMm92OEFNODgvZ05iWDhvc0NyYzV4TUFBMkhvNndJWEhUdDErNEMxaVp3TVc4TnZ6WWNDTjY3dkFJQ0JNUFoxZ2FsaXAzUVhjQVhIWHp5VmxCOEFZeWlUNXdBWUNXTmZGMWd0WUdZV0F1ZmhOeW55VFdxaUR3UE9qZWVsblFpWVNoTVFCcjUrWU5JV3pNd3k0Q1g2OWFmdjFOTlJ3SHIwN0ZLRXdEVDRoVFBzNndMN1ArdEN4UUtYbS9laWZKOTYzd21NRjdoQ1lXQlhHSmRwQXNCVW9wa1pBeXYzajMraTlQVXRUYS9VOVZjQUdDMXdtZ0F3RnNhK0xuQm9vTHhqNEswdDJxam84QUF3V3VBSUFPOFR6bm9TQU5NRVptWUVyQTE0cDNFeU1GN2dTZ0xBUUJqNEltQlZnNWtaQU0vOHU0VkFKd0o3bCsyR0FEQVFCcjRBMkQrMVowb01uS00zWTJjRDR3VU9BQU5oNUl1QjZjSk9zeGc0UTBlZUN3d1h1RkVUQm5aTERmU1ZBMU53WnNiQUpYd04vQytCNzc3MUJBQWpZZXlMZ1gwejh5QUNWbGF3eDFOYVhoKzVUY01MSEFDR3d0Z1hBNk9aMlFVT2JkR3NvcmZhYmpJc3I0d2NOT0FDQjRDQk1QTEZ3T0hwY3V3eDhOV2dMWFRKVVJXMEgxZ3RuZ1VPQThjTEx6MUZBc09aV1E0TWZGSDVCOENWN3g3NWI0RC9OSGR1UzQ3Q01CQ1Z3WUZBaURFbUNRVCsvei8zWld1bWFoMW90WmRML014TVpjNWd5YkphblU4dExJOURoRjhQRVNYSjEwazY0UEF4eW4xTGlQaXNNaHIvTjhrTkhGK2Jwd1BPaXM5NStqdVMzSUpPcnNnUVlCbFhqMm1XRlZIUmdIR0MrNHBqMmtLamJHNHVmS0dSTG1kdFRUSmdjMTJXS24xQm9mRTd6QlRYekFod3RsSXFQOWg1Z21UQWJxMXhjSHFwdkJiSEJnUlk3c3VYUFRsL1JPTUI0d1IzNm1VUEtqWG5Od0xjclZ4WFhpbVJaVExnREJTaVoxNVhZajNYQXdBV3Yzemg3Z25BWHRJQXg2RXRucTg4OGNJZFgvZlpEZ0R1bDF0R3ZmNFZ0bjBTNE04SjdpN1JPcTFsaENWSHp6d0d2QnBZYko1QU9FZ3E0RUV6Wm41SzAxTXJtcXZOT21EVExyZnQrOEZTUnpRZWNGQnBPMDVwMjZ0bG53N29Jc28xNFluSjNpNWFMNkRGMHdNdWxlcWtNNFFuK3NtY0FLUlRMMVk2NVVEUVZBTytXSzIrN2dUcGxINTR1c2pXQVhlaytLK0xDdXhFd0dNTHVsMFI0RVBGZno4TDE4enpLbUR4SUtTQ045NUxJdUJHcjNHdWpwZXZFcnF4R1FEdUxhUHV5VUFmQkFQR2c2TXg0T01FMkRoUVZnVUpXQUl6UW5CRmZSQWVNSTVOMVhFakJCaXdqQ3hnMCtxSFlHN3d0L0dBOGNhcERoK0NxWWtwQ295a2pQS1dlc2lvMmd5d0V3RDRxREV1RE5qVUpHQ3B0UXFVQUI1TUIzdzFBUEJoZzRnWXNQUXRDYmliMDBacGkzd3J3TTFGQU9CalIybHJaQlhDQVJZM0o2MjNiQVM0eUFRQVBuSVlIQU9Xa2dTYzJ4UytUN01WNENBQThMRjJCaGl3QkF3WVA0K2xQQnNCZGdJQUgyWElnUUhqVGYrU3JSdzVhdUVBRzVEZzlJRDN0NVRCZ00zRVdSODhlTUFWQ1ZpZVlNNWFEWGdIVXlRQW1LaVpSOW5JRmNrSkMvZ0ZuQUxVZ0hldzlRS0FpWnE1QTMrRVhzcERBdzdnUDY0R3ZJY3hYUXZmSGwyQjd0aW96U2YreTFKU05RMzFnUllEUWI2SHRlS1E0QjNzNFF1Y2ZsUnJEVzhPS2lIQnVqQ08zczB1NXFBandLUjB2bmtEb3pMMWVtZ2Q1VzZFV2ExdWQ3bDk3RzBuM2poWXpBQ09FTWxIdFZwamVCQS9tTGYvN0lPb1FzYTd5K2I3R0RSM1Jidzk4ZktRTHkrNXh2N1ZJWG93SWh5MXp0VWZiZHpMWXJ6N2NicnZSYi9LK25mN3dQUFFwQVhzRVEvN2wyQVhXOTcvQUdrQ3dhTnNJaWY4elUzeTVlWmFPL21LL2pLRFYxczg3Mi9GejExSzVUTEUxenpFaVAxa204bmRETWNqM0p2bUZmcWR2dWJoRDhUZ0hQaU4rTFZpQUFBQUFFbEZUa1N1UW1DQyIvPgogICAgICAgIDxkaXYgY2xhc3M9ImluZm8iPgogICAgICAgICAgICA8cD48c3Bhbj5TZXJ2ZXIgbmFtZTo8L3NwYW4+IDxzcGFuPnNlcnZlcl9ob3N0bmFtZTwvc3Bhbj48L3A+CiAgICAgICAgICAgIDxwPjxzcGFuPlNlcnZlciBhZGRyZXNzOjwvc3Bhbj4gPHNwYW4+c2VydmVyX2FkZHJlc3M8L3NwYW4+PC9wPgogICAgICAgICAgICA8cCBjbGFzcz0ic21hbGxlciI+PHNwYW4+VXNlciBBZ2VudDo8L3NwYW4+IDxzcGFuPmNsaWVudF9icm93c2VyPC9zcGFuPjwvcD4KICAgICAgICAgICAgPHAgY2xhc3M9InNtYWxsZXIiPjxzcGFuPlVSSTo8L3NwYW4+IDxzcGFuPnNlcnZlcl91cmw8L3NwYW4+PC9wPgogICAgICAgICAgICA8cCBjbGFzcz0ic21hbGxlciI+PHNwYW4+RG9jIFJvb3Q6PC9zcGFuPiA8c3Bhbj5kb2N1bWVudF9yb290PC9zcGFuPjwvcD4KICAgICAgICAgICAgPHAgY2xhc3M9InNtYWxsZXIiPjxzcGFuPkRhdGU6PC9zcGFuPiA8c3Bhbj5zZXJ2ZXJfZGF0ZTwvc3Bhbj48L3A+CiAgICAgICAgICAgIDxwIGNsYXNzPSJzbWFsbGVyIj48c3Bhbj5OR0lOWCBGcm9udGVuZCBMb2FkIEJhbGFuY2VyIElQOjwvc3Bhbj4gPHNwYW4+cmVtb3RlX2FkZHI8L3NwYW4+PC9wPgogICAgICAgICAgICA8cCBjbGFzcz0ic21hbGxlciI+PHNwYW4+Q2xpZW50IElQOjwvc3Bhbj4gPHNwYW4+cHJveGllZF9mb3JfaXA8L3NwYW4+PC9wPgogICAgICAgICAgICA8cCBjbGFzcz0ic21hbGxlciI+PHNwYW4+TkdJTlggVmVyc2lvbjo8L3NwYW4+IDxzcGFuPm5naW54X3ZlcnNpb248L3NwYW4+PC9wPgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9ImNoZWNrIj4KICAgICAgICAgICAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0iY2hlY2siIG9uY2hhbmdlPSJjaGFuZ2VDb29raWUoKSI+IEF1dG8gUmVmcmVzaDwvaW5wdXQ+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBpZD0iZm9vdGVyIj4KICAgICAgICAgICAgPGRpdiBpZD0iY2VudGVyIiBhbGlnbj0iY2VudGVyIj4KICAgICAgICAgICAgICAgIFJlcXVlc3QgSUQ6IHJlcXVlc3RfaWQ8YnIvPgogICAgICAgICAgICAgICAgwqkgTkdJTlgsIEluYy4gMjAxOAogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgIDwvYm9keT4KPC9odG1sPg==" | cat > /var/tmp/demo.txt

echo "[INFO] Creating /var/tmp/app.txt"
echo "c2VydmVyIHsKICAgIGxpc3RlbiA4MCBkZWZhdWx0X3NlcnZlcjsKICAgIHNlcnZlcl9uYW1lIGFwcF9zZXJ2ZXI7CgogICAgcm9vdCAvdXNyL3NoYXJlL25naW54L2h0bWw7CiAgICBlcnJvcl9sb2cgL3Zhci9sb2cvbmdpbngvYXBwLXNlcnZlci1lcnJvci5sb2cgbm90aWNlOwogICAgaW5kZXggZGVtby1pbmRleC5odG1sIGluZGV4Lmh0bWw7CiAgICBleHBpcmVzIC0xOwoKICAgIHN1Yl9maWx0ZXJfb25jZSBvZmY7CiAgICBzdWJfZmlsdGVyICdzZXJ2ZXJfaG9zdG5hbWUnICckaG9zdG5hbWUnOwogICAgc3ViX2ZpbHRlciAnc2VydmVyX2FkZHJlc3MnICAnJHNlcnZlcl9hZGRyOiRzZXJ2ZXJfcG9ydCc7CiAgICBzdWJfZmlsdGVyICdzZXJ2ZXJfdXJsJyAgICAgICckcmVxdWVzdF91cmknOwogICAgc3ViX2ZpbHRlciAncmVtb3RlX2FkZHInICAgICAnJHJlbW90ZV9hZGRyOiRyZW1vdGVfcG9ydCc7CiAgICBzdWJfZmlsdGVyICdzZXJ2ZXJfZGF0ZScgICAgICckdGltZV9sb2NhbCc7CiAgICBzdWJfZmlsdGVyICdjbGllbnRfYnJvd3NlcicgICckaHR0cF91c2VyX2FnZW50JzsKICAgIHN1Yl9maWx0ZXIgJ3JlcXVlc3RfaWQnICAgICAgJyRyZXF1ZXN0X2lkJzsKICAgIHN1Yl9maWx0ZXIgJ25naW54X3ZlcnNpb24nICAgJyRuZ2lueF92ZXJzaW9uJzsKICAgIHN1Yl9maWx0ZXIgJ2RvY3VtZW50X3Jvb3QnICAgJyRkb2N1bWVudF9yb290JzsKICAgIHN1Yl9maWx0ZXIgJ3Byb3hpZWRfZm9yX2lwJyAgJyRodHRwX3hfZm9yd2FyZGVkX2Zvcic7Cn0=" | cat > /var/tmp/app.txt

echo "[INFO] base64decode text files into demo-index.html and app.conf"
base64 -d /var/tmp/demo.txt > /var/tmp/demo-index.html
base64 -d /var/tmp/app.txt > /var/tmp/app.conf

echo "[INFO] place demo-index.html and app.conf in their correct locations add healthz.html"
mv /var/tmp/demo-index.html /usr/share/nginx/html/demo-index.html
rm /usr/share/nginx/html/index.html
mv /var/tmp/app.conf /etc/nginx/conf.d/app.conf
rm /etc/nginx/sites-enabled/default
echo "VF-ReadytoServe" > /usr/share/nginx/html/healthz.html
sed -i 's/Hello World - App X.*/Hello World - App ${nginxinstance}\<\/title\>/g' /usr/share/nginx/html/demo-index.html

echo "[INFO] restart nginx"
systemctl restart nginx